# Semaphore Configuration
semaphore.permits=10

# ===== SPRING APPLICATION =====
spring.application.name=aggservice
server.port=8080

# ===== DATASOURCE (MySQL) =====
spring.datasource.url=jdbc:mysql://${DB_HOST:mysql-db}:${DB_PORT:3306}/${DB_NAME:aggservice_db}
spring.datasource.username=${DB_USER:admin}
spring.datasource.password=${DB_PASSWORD:admin}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ===== JPA/HIBERNATE =====
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# ===== REDIS CACHE =====
spring.redis.host=${REDIS_HOST:redis-cache}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.timeout=60000ms
spring.redis.jedis.pool.max-active=8
spring.redis.jedis.pool.max-idle=8
spring.redis.jedis.pool.min-idle=0

# ===== CACHE CONFIGURATION =====
spring.cache.type=redis
spring.cache.redis.time-to-live=600000
spring.cache.redis.cache-null-values=true

# ===== MQTT CONFIGURATION =====
spring.mqtt.url=tcp://${MQTT_HOST:mqtt-broker}:${MQTT_PORT:1883}
spring.mqtt.client-id=${MQTT_CLIENT_ID:aggservice-1}
spring.mqtt.username=${MQTT_USER:admin}
spring.mqtt.password=${MQTT_PASSWORD:admin}
spring.mqtt.topics.scale-request=lb/scale/request
spring.mqtt.topics.scale-response=lb/scale/response
spring.mqtt.topics.health=aggservice/health
spring.mqtt.topics.metrics=aggservice/metrics
spring.mqtt.qos=1
spring.mqtt.keep-alive-interval=60

# ===== SERVER CONFIGURATION =====
server.servlet.context-path=/
server.compression.enabled=true
server.compression.min-response-size=1024

# ===== ACTUATOR ENDPOINTS (Monitoring & Health Checks) =====
management.endpoints.web.exposure.include=health,metrics,prometheus,info,env
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=when-authorized
management.health.defaults.enabled=true
management.health.db.enabled=true
management.health.redis.enabled=true
management.health.circuitbreakers.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=${ENVIRONMENT:development}

# ===== LOGGING CONFIGURATION =====
logging.level.root=INFO
logging.level.com.ntu.cloudgui=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/aggservice.log
logging.file.max-size=10MB
logging.file.max-history=10

# ===== APPLICATION CONFIGURATION =====
app.semaphore.permits=${SEMAPHORE_PERMITS:10}
app.semaphore.fair=true

# ===== AGGREGATION SERVICE CONFIGURATION =====
app.aggregation.batch-size=${BATCH_SIZE:100}
app.aggregation.timeout-seconds=${TIMEOUT_SECONDS:30}
app.aggregation.max-retries=${MAX_RETRIES:3}

# ===== FILE PROCESSING CONFIGURATION =====
app.file.upload-dir=${FILE_UPLOAD_DIR:/tmp/uploads}
app.file.max-size-mb=${MAX_FILE_SIZE:500}
app.file.allowed-extensions=pdf,txt,csv,json,xlsx,docx

# ===== LOAD BALANCER CONFIGURATION =====
app.load-balancer.enabled=${LB_ENABLED:true}
app.load-balancer.health-check-interval-seconds=${HEALTH_CHECK_INTERVAL:10}
app.load-balancer.metrics-push-interval-seconds=${METRICS_PUSH_INTERVAL:30}

# ===== SECURITY CONFIGURATION =====
app.security.jwt.secret=${JWT_SECRET:default-secret-key-change-in-production}
app.security.jwt.expiration=${JWT_EXPIRATION:3600000}
app.security.jwt.algorithm=${JWT_ALGORITHM:HS256}
app.security.api-key=${API_KEY:default-api-key-change-in-production}
app.security.enable-cors=${ENABLE_CORS:true}
app.security.cors-allowed-origins=${CORS_ALLOWED_ORIGINS:*}

# ===== ENVIRONMENT INDICATOR =====
environment=${ENVIRONMENT:development}